generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  passwordHash  String
  name          String
  phone         String?
  profileImage  String?
  createdAt     DateTime @default(now())
  requests      Request[]
  reports       Report[]
  transactions  Transaction[]
  chatRooms     ChatRoom[]
  messages      Message[]
}

model Request {
  id            Int      @id @default(autoincrement())
  userId        Int
  user          User     @relation(fields: [userId], references: [id])
  category      String
  title         String
  description   String
  rewardAmount  Decimal
  depositAmount Decimal
  location      String
  status        String   @default("OPEN") // OPEN, IN_PROGRESS, COMPLETED, CANCELED
  images        String[]
  createdAt     DateTime @default(now())
  reports       Report[]
  transactions  Transaction[]
  chatRooms     ChatRoom[]
}

model Report {
  id            Int      @id @default(autoincrement())
  requestId     Int
  request       Request  @relation(fields: [requestId], references: [id])
  reporterId    Int
  reporter      User     @relation(fields: [reporterId], references: [id])
  description   String
  images        String[]
  location      String
  status        String   @default("PENDING") // PENDING, ACCEPTED, REJECTED
  createdAt     DateTime @default(now())
  transactions  Transaction[]
}

model Transaction {
  id            Int      @id @default(autoincrement())
  requestId     Int?
  request       Request? @relation(fields: [requestId], references: [id])
  reportId      Int?
  report        Report?  @relation(fields: [reportId], references: [id])
  userId        Int
  user          User     @relation(fields: [userId], references: [id])
  amount        Decimal
  type          String   // DEPOSIT, REWARD, REFUND
  status        String   // PENDING, COMPLETED, FAILED
  createdAt     DateTime @default(now())
}

model ChatRoom {
  id        Int       @id @default(autoincrement())
  requestId Int?
  request   Request?  @relation(fields: [requestId], references: [id])
  users     User[]    // Implicit many-to-many for simplicity, or explicit if needed
  messages  Message[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Message {
  id         Int      @id @default(autoincrement())
  chatRoomId Int
  chatRoom   ChatRoom @relation(fields: [chatRoomId], references: [id])
  senderId   Int
  sender     User     @relation(fields: [senderId], references: [id])
  content    String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
}
